Музыкальный звонок

*Введение
Когда возникла необходимость установить дверной звонок было два варианта:
купить готовый или сделать самому.
У готовыйх звонков был  ряд недостатков:
встроеные мелодии не отличаются качеством и разнообразием
нет регулятора громкости.

Но зато есть готовый корпус и в некоторых моделях радиокнопка.

Поэтому за основу я взял дешевый китайский звонок с радиокнопкой и поставил в него
свой синтезатор мелодии с регулированием громкости и блокированием включения.

В качестве мелодии можно загрузить большинство midi файлов.
Чтобы сконвертировать midi в формат, пригодный для прошивки в архиве проекта
есть программа Continy45 (автор Dmitry Dubrovenko http://www.dubrovenko.ru)

За основу звукогенератора взята музыкальная шкатулка
http://elm-chan.org/works/mxb/report.html

Образец звучания.
http://elm-chan.org/works/mxb/mg.mpg

Данная программа может воспроизводить одновременно 6 каналов. Звучание для дверного звонка, 
я считаю, очень неплохое. По крайней мере гораздо лучше, чем в магазинных звонках.

*Особенности звонка
Алгоритм работы музыкальной шкатулки был слегка переработан:
Включение мелодии с помощью отдельной кнопки
Можно заблокировать воспроизведение мелодии с помощью специального входа.
Индикация блокировки мелодии на одном из выходов.

Для увеличения громкости добавлен простой усилитель с регулятором громкости.

В качестве корпуса был звонок с  питанием от батареек, поэтому батарейный отсек послужил отличным
местом для установки новой платы.

В качесте источника питания был пременен слегка модернизированый б/п для зарядки сотового
телефона. В принципе подойдет любой источник питания от 3 до 5В.

Микросхема звукогенератора была выпаяна, сигнал от кнопки заводится на новую плату.

Для индикации работы применяются два светодиода: зеленый - индикатор питания,  красный - блокировка звонка.
К звонку можно подключить геркон, устанавливаемый на дверь. При открытии двери воспроизведение
мелодии прекращается.
На корпусе звонка есть переключатель для полной блокировки включения.

*Принципиальная схема

*Печатная плата

*Прошивка


*Редактирование мелодии.
Можно предварительно отредактировать мелодию в midi, редакторе. Но это не так просто если не знаком
с таким родом программ. Зачастую проще сковертировать мелодию в формат прошивки, а в файле с мелодией
удалить часть мелодии. Этот метод не очень удобный но самый простой, если надо сократить длину мелодии.


*Примечания по количеству мелодий:
Данная прошивка подразумевает одну мелоди.
Несложно доработать прошивку таким образом, чтобы она воспроизводила несколько мелодий.
В Attiny45 можно записать 2 короткие мелодии. Если надо больше мелодий, можно применить
Attiny85 с 8кб флеш памяти. 






avrdude: reading lfuse memory:

Reading | ################################################## | 100% 0.01s

avrdude: writing output file "<stdout>"
:01000000D12E
:00000001FF
avrdude: reading hfuse memory:

Reading | ################################################## | 100% 0.01s

avrdude: writing output file "<stdout>"
:01000000DD22
:00000001FF
avrdude: reading efuse memory:

Reading | ################################################## | 100% 0.01s

avrdude: writing output file "<stdout>"
:01000000FF00
:00000001FF





